## Backend Specs â€“ AI Chat Service (FastAPI)

### Purpose

* Handle chat messages
* Run AI agent
* Invoke MCP tools
* Persist conversation history
* Remain stateless


### Chat API

*Endpoint*


POST /api/{user_id}/chat


*Request*

json
{
  "conversation_id": optional integer,
  "message": string
}


*Response*

json
{
  "conversation_id": integer,
  "response": string,
  "tool_calls": array
}



### Database Models

*Conversation*

* id
* user_id
* created_at
* updated_at

*Message*

* id
* conversation_id
* user_id
* role (user | assistant)
* content
* created_at


## MCP Tools Specification

(same as before â€” no change)

* add_task
* list_tasks
* update_task
* complete_task
* delete_task

ðŸ‘‰ All tools enforce user ownership.

## Agent Behavior Rules

* Interpret user intent
* Call MCP tools only
* Confirm actions naturally
* Handle missing or invalid tasks gracefully



## Stateless Conversation Flow

1. Frontend sends message
2. Backend loads conversation from DB
3. User message stored
4. Agent runs with MCP tools
5. Tool calls executed
6. Assistant reply stored
7. Response returned
8. No server memory retained



## Security Rules

* JWT required
* user_id from token must match route
* Unauthorized â†’ 401 / 403
* AI never sees other usersâ€™ data

